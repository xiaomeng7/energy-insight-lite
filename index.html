<!DOCTYPE html>
<!--
  CHANGELOG (refactor): Facebook emotional scroll → 2-minute check → free preview → paid unlock → full result.
  - SECTION 0: Full-screen hero (100vh) with bill-photo placeholder, dark overlay, emotional copy; CTA smooth-scroll to bridge. No $199.
  - SECTION 1: Bridge (emotion→logic) with 3 bullets; CTA to 2-minute check.
  - SECTION 2: Multi-step form unchanged (≤7 questions); inline errors on Next when required missing; progress Step X of Y; on complete scroll to results.
  - SECTION 3: (A) Free preview: usage band + brief Assumptions (preview) accordion, bridge sentence only — no savings/payback. (B) Locked card: "See your estimated annual savings" with blurred placeholders; Unlock opens "Payment coming next" modal; on close → render full result. (C) Full result: 7-block report when unlocked (URL ?unlocked=1 or localStorage lite_unlocked).
  - Unlock: click sets localStorage, opens modal; closing modal renders full result (no Stripe).
  - Tracking: page_open, hero_cta_click, bridge_cta_click, snapshot_start, question_view, question_answer, snapshot_complete, unlock_click, unlock_modal_submit.

  CHANGELOG (polish): Smoother transition from HERO to 2-minute check.
  - Bridge section: heading "You're not alone.", editorial 3 bullets (max 10 words), single CTA "Start the 2-minute check", white bg, generous padding, subtle divider below.
  - Form section: light grey (#f7f7f7) page bg, centered white card (max-width 720px), progress "Step X of Y" + thin bar at top of card, one question per step with h2 + helper text, large tap targets (radio tiles, chip multi-select), Back/Next, inline error on Next click, Enter = Next; microcopy: "This takes about 2 minutes.", "No bill upload required.", "You'll get an instant preview." (no $199 in form).
  - Results: smooth-scroll on completion + CSS fade-in when results appear.
-->
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XFGTZ3XWWQ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XFGTZ3XWWQ');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Energy Insight (Lite) | See your solar savings potential</title>
  <meta name="description" content="See how much a standard 6.6kW solar system could save you each year. Quick 2-minute check.">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' fill='%230d6efd'/><text x='16' y='22' font-size='18' text-anchor='middle' fill='white' font-family='sans-serif'>E</text></svg>" type="image/svg+xml">
  <style>
    *, *::before, *::after { box-sizing: border-box; }
    :root {
      --bg: #f8f9fa;
      --text: #1a1a1a;
      --muted: #5c5c5c;
      --accent: #0d6efd;
      --accent-hover: #0b5ed7;
      --border: #dee2e6;
      --card: #fff;
      --radius: 8px;
      --shadow: 0 1px 3px rgba(0,0,0,.08);
      --font: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    body {
      margin: 0;
      font-family: var(--font);
      font-size: 1rem;
      line-height: 1.5;
      color: var(--text);
      background: var(--bg);
      -webkit-font-smoothing: antialiased;
    }
    .container { max-width: 640px; margin: 0 auto; padding: 0 1rem; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
    h1, h2, h3 { margin: 0 0 .5em; font-weight: 600; }
    h1 { font-size: clamp(1.5rem, 4vw, 2rem); }
    h2 { font-size: 1.25rem; }
    p { margin: 0 0 1em; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    button, .btn {
      display: inline-block;
      padding: .6rem 1.2rem;
      font: inherit;
      font-size: 1rem;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      transition: background .2s;
    }
    button:hover, .btn:hover { background: var(--accent-hover); }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .btn-secondary { background: var(--border); color: var(--text); }
    .btn-secondary:hover { background: #ced4da; }
    input[type="text"], input[type="email"], input[type="tel"] {
      width: 100%;
      padding: .6rem .75rem;
      font: inherit;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      margin-bottom: .5rem;
    }
    input:focus { outline: 2px solid var(--accent); outline-offset: 2px; }
    input.error { border-color: #dc3545; }
    label { display: block; margin-bottom: .25rem; font-weight: 500; }
    .muted { color: var(--muted); font-size: .9375rem; }
    /* SECTION 0 — Hero (full-screen, emotional) */
    .hero {
      position: relative;
      height: 100vh;
      background-image: url('bill-night.png');
      background-size: cover;
      background-position: center bottom;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      text-align: center;
      padding-top: 18vh;
    }
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        rgba(0,0,0,0.75) 0%,
        rgba(0,0,0,0.55) 40%,
        rgba(0,0,0,0.35) 70%,
        rgba(0,0,0,0.2) 100%
      );
    }
    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 800px;
      padding: 20px;
      color: white;
    }
    .hero h1 {
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 20px;
    }
    .hero .sub {
      font-size: 20px;
      line-height: 1.6;
      opacity: 0.9;
      margin-bottom: 30px;
    }
    .hero button {
      background: #ff4d4f;
      border: none;
      padding: 14px 28px;
      font-size: 16px;
      border-radius: 30px;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .hero button:hover {
      background: #ff2a2d;
    }
    @media (max-width: 600px) {
      .hero h1 { font-size: clamp(1.5rem, 8vw, 2rem); }
      .hero .sub { font-size: 1rem; }
    }
    /* SECTION 1 — Bridge (emotion → logic, editorial) */
    .section-1 {
      background: #fff;
      padding: 4rem 1.5rem;
      border-bottom: 1px solid var(--border);
    }
    .section-1 .bridge-inner { max-width: 560px; margin: 0 auto; }
    .section-1 .bridge-heading { font-size: clamp(1.5rem, 4vw, 1.75rem); font-weight: 600; margin: 0 0 1.5rem; color: var(--text); }
    .section-1 .bridge-list {
      margin: 0 0 2rem;
      padding-left: 1.5rem;
      font-size: 1.125rem;
      line-height: 1.8;
      color: var(--text);
    }
    .section-1 .bridge-list li { margin-bottom: 0.75rem; }
    .section-1 .bridge-cta { margin-top: 0.5rem; }
    .section-1 .bridge-cta .btn { padding: 0.75rem 1.5rem; font-size: 1.0625rem; }
    @media (max-width: 600px) {
      .section-1 { padding: 3rem 1rem; }
      .section-1 .bridge-list { font-size: 1.0625rem; }
    }
    .section {
      padding: 2rem 0;
      border-top: 1px solid var(--border);
    }
    .section-title { text-align: center; margin-bottom: 1.5rem; }
    .steps {
      display: grid;
      gap: 1.5rem;
      margin-top: 1rem;
    }
    .step-card {
      background: var(--card);
      padding: 1.25rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .step-num { font-weight: 700; color: var(--accent); margin-bottom: .35em; }
    /* SECTION 2 — 2-minute check (card on calm grey) */
    #form-section {
      background: #f7f7f7;
      padding: 3rem 1rem 4rem;
    }
    #form-section .form-card-wrap { max-width: 720px; margin: 0 auto; }
    .form-card {
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,.06);
      padding: 2rem 1.5rem;
    }
    .form-panel {
      display: none;
      padding: 0;
    }
    .form-panel.active { display: block; }
    .form-panel .form-question { margin-bottom: 1.5rem; }
    .form-panel h2 { font-size: clamp(1.25rem, 3vw, 1.5rem); font-weight: 600; margin: 0 0 0.5rem; color: var(--text); }
    .form-panel .form-helper { font-size: 0.9375rem; color: var(--muted); margin-bottom: 1.25rem; }
    .progress-wrap { margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border); }
    .progress-bar {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      overflow: hidden;
      margin-top: 0.5rem;
    }
    .progress-fill {
      height: 100%;
      background: var(--accent);
      width: 0%;
      transition: width .3s ease;
    }
    .progress-text { font-size: 0.875rem; color: var(--muted); margin: 0; }
    .form-nav { display: flex; justify-content: space-between; margin-top: 2rem; gap: 1rem; }
    .form-nav .btn { min-width: 110px; padding: 0.7rem 1.25rem; }
    .option-group { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 0.5rem; }
    .option-btn {
      padding: 0.85rem 1.25rem;
      min-height: 48px;
      border: 2px solid var(--border);
      background: #fff;
      color: var(--text);
      border-radius: var(--radius);
      cursor: pointer;
      font: inherit;
      font-size: 1rem;
      transition: border-color .2s, background .2s;
    }
    .option-btn:hover { border-color: var(--accent); background: #f8faff; }
    .option-btn.selected { border-color: var(--accent); background: rgba(13, 110, 253, .1); color: var(--text); }
    .chip-group { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
    .chip-group label {
      display: inline-flex;
      align-items: center;
      padding: 0.6rem 1rem;
      min-height: 48px;
      border: 2px solid var(--border);
      border-radius: 24px;
      background: #fff;
      cursor: pointer;
      font-size: 0.9375rem;
      font-weight: normal;
      color: var(--text);
      transition: border-color .2s, background .2s;
    }
    .chip-group label:hover { border-color: var(--accent); background: #f8faff; }
    .chip-group input[type="checkbox"] { width: auto; margin: 0 0.5rem 0 0; accent-color: var(--accent); }
    .form-card .form-intro { font-size: 0.9375rem; color: var(--muted); margin-bottom: 1.5rem; line-height: 1.5; }
    .form-card input[type="text"], .form-card input[type="email"], .form-card input[type="tel"] {
      padding: 0.75rem 1rem;
      min-height: 48px;
      font-size: 1rem;
    }
    .checkbox-group label { display: flex; align-items: center; gap: .5rem; cursor: pointer; margin-bottom: .5rem; font-weight: normal; color: var(--text); min-height: 44px; }
    .checkbox-group input[type="checkbox"] { width: auto; margin: 0; accent-color: var(--accent); }
    .results-section { display: none; padding: 3rem 0; opacity: 0; transition: opacity 0.4s ease; }
    .results-section.visible { display: block; animation: resultsFadeIn 0.5s ease forwards; }
    @keyframes resultsFadeIn { from { opacity: 0; } to { opacity: 1; } }
    .profile-card {
      background: var(--card);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
    }
    .profile-card h3 { margin-bottom: .75rem; }
    .usage-band { font-size: 1.25rem; font-weight: 600; color: var(--accent); margin: .5rem 0; }
    .accordion { margin: 1rem 0; }
    .accordion-item { border: 1px solid var(--border); border-radius: var(--radius); margin-bottom: .5rem; overflow: hidden; background: #fff; }
    .accordion-head {
      width: 100%;
      padding: .75rem 1rem;
      text-align: left;
      font: inherit;
      font-weight: 600;
      color: var(--text);
      background: #f0f2f5;
      border: none;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .accordion-head:hover { background: #e5e7eb; }
    .accordion-head::after { content: "+"; font-size: 1.25rem; color: var(--text); }
    .accordion-item.open .accordion-head::after { content: "−"; }
    .accordion-body { padding: 1rem 1.25rem; border-top: 1px solid var(--border); display: none; background: #fff; color: var(--text); font-size: 0.9375rem; line-height: 1.6; }
    .accordion-body ul { margin: 0; padding-left: 1.25rem; }
    .accordion-body li { margin-bottom: 0.35rem; }
    .accordion-item.open .accordion-body { display: block; }
    .locked-box {
      position: relative;
      background: var(--card);
      padding: 2rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }
    .locked-box .blur-content {
      filter: blur(8px);
      pointer-events: none;
      user-select: none;
      min-height: 120px;
    }
    .locked-box .locked-line { margin: 0.5rem 0; }
    .locked-box .unlock-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,.85);
    }
    .locked-box .unlock-overlay .btn { margin-top: .5rem; }
    .unlock-urgency { font-size: 1rem; font-weight: 600; margin: 0 0 .75rem; color: var(--text); }
    .locked-summary { font-size: 18px; margin-bottom: 10px; }
    .unlock-note { font-size: 13px; opacity: 0.7; margin-top: 6px; }
    .result-confirmation { font-size: 20px; font-weight: 600; margin-bottom: 15px; }
    .pro-upgrade-box { margin-top: 30px; padding: 20px; border: 1px solid #eee; border-radius: 8px; }
    .pro-upgrade-box h3 { margin: 0 0 0.5rem; font-size: 1.1rem; }
    .pro-upgrade-box p { margin: 0 0 1rem; font-size: 0.9375rem; }
    .pro-upgrade-box .pro-btn { display: inline-block; padding: 0.6rem 1.2rem; background: var(--accent); color: #fff; border-radius: var(--radius); text-decoration: none; font-weight: 500; }
    .pro-upgrade-box .pro-btn:hover { background: var(--accent-hover); }
    .credit-note { font-size: .75rem; color: var(--muted); margin-top: 1rem; }
    .credit-emphasis { font-size: .875rem; font-weight: 600; color: var(--text); margin-top: 0.5rem; }
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      margin: 1.5rem 0;
    }
    .comparison-table th, .comparison-table td { padding: .75rem 1rem; text-align: left; border-bottom: 1px solid var(--border); }
    .comparison-table th { background: var(--bg); font-weight: 600; }
    .comparison-table tr:last-child td { border-bottom: none; }
    .faq-list { margin: 0; padding: 0; list-style: none; background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; border: 1px solid var(--border); }
    .faq-item { border-bottom: 1px solid var(--border); }
    .faq-item:last-child { border-bottom: none; }
    .faq-q {
      width: 100%;
      padding: 1rem 1.25rem;
      text-align: left;
      font: inherit;
      font-weight: 500;
      color: var(--text);
      background: #fff;
      border: none;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .faq-q:hover { color: var(--accent); background: #f8f9fa; }
    .faq-q::after { content: "+"; font-size: 1.25rem; }
    .faq-item.open .faq-q::after { content: "−"; }
    .faq-a { padding: 0 1.25rem 1rem; margin: 0; color: var(--text); font-weight: normal; display: none; }
    .faq-item.open .faq-a { display: block; }
    footer {
      padding: 2rem 0;
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: .9rem;
      color: var(--muted);
    }
    footer a { color: var(--muted); }
    footer a:hover { color: var(--text); }
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 1rem;
    }
    .modal-backdrop.visible { display: flex; }
    .modal {
      position: relative;
      background: var(--card);
      padding: 1.5rem;
      border-radius: var(--radius);
      max-width: 400px;
      width: 100%;
      max-height: 90vh;
      overflow: auto;
    }
    .modal h3 { margin-bottom: 1rem; }
    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--muted);
      padding: 0;
      line-height: 1;
    }
    .modal-close:hover { color: var(--text); }
    .modal .checkbox-group { margin: 1rem 0; }
    .error-msg { color: #dc3545; font-size: .875rem; margin-top: .25rem; display: none; }
    .error-msg.visible { display: block; }
    @media (min-width: 600px) {
      .steps { grid-template-columns: repeat(3, 1fr); }
    }

    /* FULL RESULT STYLES */
    .hidden { display: none !important; }
    .full-result { margin-bottom: 1.5rem; }
    .full-result .report-card {
      background: var(--card);
      padding: 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 1.25rem;
      border: 1px solid var(--border);
    }
    .full-result .report-header {
      padding-bottom: 1rem;
      margin-bottom: 1rem;
      border-bottom: 1px solid var(--border);
    }
    .full-result .report-header h2 { margin: 0 0 0.25rem; font-size: 1.25rem; }
    .full-result .report-header .subline { font-size: .875rem; color: var(--muted); }
    .full-result .report-header .badges { font-size: .75rem; color: var(--muted); margin-top: 0.5rem; }
    .full-result .hero-summary .big-number { font-size: 1.75rem; font-weight: 700; color: var(--accent); margin: 0.25rem 0; }
    .full-result .hero-summary .label { font-size: .875rem; color: var(--muted); }
    .full-result .hero-summary .footnote { font-size: .75rem; color: var(--muted); margin-top: 1rem; }
    .full-result .decision-outlook { display: flex; align-items: flex-start; gap: 0.75rem; }
    .full-result .decision-outlook .icon { font-size: 1.5rem; line-height: 1; }
    .full-result .decision-outlook .label { font-weight: 600; margin-bottom: 0.25rem; }
    .full-result .next-steps-grid { display: grid; gap: 1rem; grid-template-columns: 1fr; max-width: 100%; }
    .full-result .advisory-note {
      background: #fef9e7;
      border: 1px solid #e8d88a;
      border-radius: var(--radius);
      padding: 0.75rem 1rem;
      font-size: 0.9375rem;
      color: #7d6e00;
    }
    .full-result .next-step-card { background: #f8f9fa; padding: 1.25rem; border-radius: var(--radius); border: 1px solid var(--border); }
    .full-result .next-step-card a.btn { color: #fff; text-decoration: none; }
    .full-result .next-step-card h4 { margin: 0 0 0.5rem; font-size: 1rem; }
    .full-result .next-step-card ul { margin: 0 0 0.75rem; padding-left: 1.25rem; font-size: .9375rem; }
    .full-result .debug-reset { font-size: .75rem; color: var(--muted); margin-top: 1rem; }
  </style>
</head>
<body>
  <main>
    <!-- SECTION 0 — Hero (emotional, full-screen). Background: bill-night.png -->
    <section class="hero" id="section-0">
      <div class="hero-overlay" aria-hidden="true"></div>
      <div class="hero-content">
        <h1>Your electricity bill went up again.</h1>
        <p class="sub">And no one can tell you if solar is actually worth it.</p>
        <button type="button" onclick="scrollToCheck()">Check my numbers ↓</button>
      </div>
    </section>

    <!-- SECTION 1 — Bridge (emotion → logic) -->
    <section class="section-1" id="section-1">
      <div class="bridge-inner">
        <ul class="bridge-list">
          <li>Some homes save thousands.</li>
          <li>Some barely break even.</li>
          <li>Most people don't know which one they are.</li>
        </ul>
        <div class="bridge-cta">
          <button type="button" class="btn" id="bridge-cta">Start the 2-minute check</button>
        </div>
      </div>
    </section>

    <!-- SECTION 2 — 2-minute check -->
    <section id="form-section">
      <div class="form-card-wrap">
        <p class="form-intro" style="text-align:center;margin-bottom:1.5rem;color:var(--muted);font-size:0.9375rem;">This takes about 2 minutes. No bill upload required. You'll get an instant preview.</p>
        <div class="form-card">
          <div class="progress-wrap">
            <p class="progress-text" id="progress-text">Step 1 of 6</p>
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
          </div>
          <form id="snapshot-form" novalidate>
            <div class="form-panel active" id="panel-1" data-step="1">
              <div class="form-question">
                <h2>What's your approximate annual electricity bill?</h2>
                <p class="form-helper">Select the range that best matches your last 12 months.</p>
                <div class="option-group" role="group" aria-label="Annual bill range">
                  <button type="button" class="option-btn" data-value="under_2000">&lt;$2,000</button>
                  <button type="button" class="option-btn" data-value="2000_3000">$2,000–$3,000</button>
                  <button type="button" class="option-btn" data-value="3000_4000">$3,000–$4,000</button>
                  <button type="button" class="option-btn" data-value="4000_5000">$4,000–$5,000</button>
                  <button type="button" class="option-btn" data-value="5000_plus">$5,000+</button>
                </div>
                <p class="error-msg" id="error-1">Please select a bill range.</p>
              </div>
              <input type="hidden" name="annualBillBand" id="annualBillBand" value="">
              <div class="form-nav">
                <span></span>
                <button type="button" class="btn" id="next-1">Next</button>
              </div>
            </div>
            <div class="form-panel" id="panel-2" data-step="2">
              <div class="form-question">
                <h2>Are you usually at home during the day?</h2>
                <p class="form-helper">e.g. work from home, retired, part-time.</p>
                <div class="option-group" role="group" aria-label="Daytime at home">
                  <button type="button" class="option-btn" data-value="yes">Yes</button>
                  <button type="button" class="option-btn" data-value="no">No</button>
                </div>
                <p class="error-msg" id="error-2">Please select Yes or No.</p>
              </div>
              <input type="hidden" name="daytimeAtHome" id="daytimeAtHome" value="">
              <div class="form-nav">
                <button type="button" class="btn btn-secondary" id="back-2">Back</button>
                <button type="button" class="btn" id="next-2">Next</button>
              </div>
            </div>
            <div class="form-panel" id="panel-3" data-step="3">
              <div class="form-question">
                <h2>Is your home all-electric (no gas)?</h2>
                <p class="form-helper">Heating, cooking, hot water.</p>
                <div class="option-group" role="group" aria-label="All electric no gas">
                  <button type="button" class="option-btn" data-value="yes">Yes</button>
                  <button type="button" class="option-btn" data-value="no">No</button>
                </div>
                <p class="error-msg" id="error-3">Please select Yes or No.</p>
              </div>
              <input type="hidden" name="allElectricNoGas" id="allElectricNoGas" value="">
              <div class="form-nav">
                <button type="button" class="btn btn-secondary" id="back-3">Back</button>
                <button type="button" class="btn" id="next-3">Next</button>
              </div>
            </div>
            <div class="form-panel" id="panel-4" data-step="4">
              <div class="form-question">
                <h2>Which of these do you have?</h2>
                <p class="form-helper">Select all that apply.</p>
                <div class="chip-group">
                  <label><input type="checkbox" name="bigLoads" value="ducted_ac"> Ducted air conditioning</label>
                  <label><input type="checkbox" name="bigLoads" value="electric_hot_water"> Electric hot water</label>
                  <label><input type="checkbox" name="bigLoads" value="electric_cooking"> Electric cooking</label>
                  <label><input type="checkbox" name="bigLoads" value="pool"> Pool</label>
                  <label><input type="checkbox" name="bigLoads" value="heat_pump_hot_water"> Heat pump hot water</label>
                </div>
              </div>
              <div class="form-nav">
                <button type="button" class="btn btn-secondary" id="back-4">Back</button>
                <button type="button" class="btn" id="next-4">Next</button>
              </div>
            </div>
            <div class="form-panel" id="panel-5" data-step="5">
              <div class="form-question">
                <h2>Are you planning to get an EV (or already have one)?</h2>
                <p class="form-helper">Electric vehicle.</p>
                <div class="option-group" role="group" aria-label="EV plan">
                  <button type="button" class="option-btn" data-value="yes">Yes</button>
                  <button type="button" class="option-btn" data-value="no">No</button>
                </div>
                <p class="error-msg" id="error-5">Please select Yes or No.</p>
              </div>
              <input type="hidden" name="evPlan" id="evPlan" value="">
              <div class="form-nav">
                <button type="button" class="btn btn-secondary" id="back-5">Back</button>
                <button type="button" class="btn" id="next-5">Next</button>
              </div>
            </div>
            <div class="form-panel" id="panel-6" data-step="6">
              <div class="form-question">
                <h2>Almost there</h2>
                <p class="form-helper">Enter your email to see your free energy profile. Name and phone are optional.</p>
                <label for="email">Email <span aria-hidden="true">*</span></label>
                <input type="email" id="email" name="email" required placeholder="you@example.com" autocomplete="email">
                <p class="error-msg" id="email-error">Please enter a valid email address.</p>
                <label for="name">Name (optional)</label>
                <input type="text" id="name" name="name" placeholder="Your name" autocomplete="name">
                <label for="phone">Phone (optional)</label>
                <input type="tel" id="phone" name="phone" placeholder="04XX XXX XXX" autocomplete="tel">
              </div>
              <div class="form-nav">
                <button type="button" class="btn btn-secondary" id="back-6">Back</button>
                <button type="submit" class="btn" id="submit-btn">See my profile</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </section>

    <!-- SECTION 3 — Results (free preview + locked / full result) -->
    <section class="results-section" id="results-section">
      <div class="container">
        <h2 class="section-title">Your results</h2>
        <!-- A) FREE PREVIEW (always visible after completion) -->
        <div class="profile-card" id="free-profile">
          <h3>Your energy profile</h3>
          <p class="usage-band" id="usage-band"></p>
          <p id="what-this-means"></p>
          <div class="accordion" id="assumptions-accordion">
            <div class="accordion-item">
              <button type="button" class="accordion-head" aria-expanded="false">Assumptions (preview)</button>
              <div class="accordion-body" id="assumptions-body"></div>
            </div>
          </div>
        </div>
        <!-- FULL RESULT (visible when unlocked) -->
        <div id="full-result" class="full-result hidden" aria-live="polite"></div>
        <!-- B) LOCKED CARD (visible when NOT unlocked) -->
        <div class="locked-box" id="locked-box">
          <div class="blur-content" aria-hidden="true">
            <div class="locked-summary">
              <strong>Financial Decision:</strong>
              <span class="blurred">Financially reasonable (locked)</span>
            </div>
            <p class="locked-line">Estimated annual savings: $X–$Y (locked)</p>
            <p class="locked-line">Estimated payback: A–B years (locked)</p>
            <p class="locked-line">Battery direction (locked)</p>
            <p class="locked-line">EV impact note (locked)</p>
          </div>
          <div class="unlock-overlay">
            <p class="unlock-urgency">Most people pay $15,000–$30,000 without checking this.</p>
            <button type="button" class="btn" id="unlock-btn">See the real numbers — $199</button>
            <p class="unlock-note">$199 credited if you proceed with Advisory Pro.</p>
          </div>
        </div>
        <p class="debug-reset hidden" id="debug-reset"><a href="#" id="reset-unlock-link">Reset unlock (for testing)</a></p>
        <!-- Lite vs Pro comparison hidden; Upgrade to Pro appears in full result after unlock -->
        <div class="comparison-table-wrap" style="display:none;" aria-hidden="true">
          <h3 style="margin-top: 2rem;">Lite vs Pro</h3>
          <table class="comparison-table" aria-label="Comparison Lite vs Pro">
            <thead>
              <tr>
                <th></th>
                <th>Energy Insight Lite</th>
                <th>Energy Insight Pro</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Price</td>
                <td>$199</td>
                <td>From $990</td>
              </tr>
              <tr>
                <td>Usage profile</td>
                <td>Yes</td>
                <td>Yes</td>
              </tr>
              <tr>
                <td>Savings estimate (6.6kW)</td>
                <td>Yes</td>
                <td>Yes</td>
              </tr>
              <tr>
                <td>Written recommendation</td>
                <td>Short written decision summary (online)</td>
                <td>Yes</td>
              </tr>
              <tr>
                <td>Tariff &amp; strategy</td>
                <td>No</td>
                <td>Yes</td>
              </tr>
              <tr>
                <td>Lite credit applied</td>
                <td>—</td>
                <td>Yes</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <section class="section" id="faq">
      <div class="container">
        <h2 class="section-title">FAQ</h2>
        <ul class="faq-list">
          <li class="faq-item">
            <button type="button" class="faq-q">Will this get me a solar quote or install?</button>
            <p class="faq-a">No. Energy Insight gives you an independent view of your usage and potential savings. It does not arrange quotes or installation.</p>
          </li>
          <li class="faq-item">
            <button type="button" class="faq-q">How accurate is the estimate?</button>
            <p class="faq-a">Unlock reveals the full estimate based on your answers. Pro improves accuracy with on-site load measurement.</p>
          </li>
          <!-- Removed for positioning: Why $199, bill uncertainty, Refund policy -->
        </ul>
      </div>
    </section>

    <footer>
      <div class="container">
        <p><strong>Better Home Technology Pty Ltd</strong></p>
        <p><a href="mailto:info@bhtechnology.com.au">info@bhtechnology.com.au</a> · <a href="tel:0493208540">0493 208 540</a></p>
        <p>Your information is used only to generate your profile and, if you opt in, to notify you when the payment step is ready. We don't sell your data.</p>
      </div>
    </footer>
  </main>

  <div class="modal-backdrop" id="unlock-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal">
      <button type="button" class="modal-close" id="modal-close" aria-label="Close">&times;</button>
      <h3 id="modal-title">Payment coming next</h3>
      <p>The full payment flow is being added. You can request an email when it's ready.</p>
      <div class="checkbox-group">
        <label><input type="checkbox" id="email-when-ready" name="emailWhenReady"> Email me when it's ready</label>
      </div>
      <button type="button" class="btn" id="unlock-modal-submit">OK</button>
    </div>
  </div>

  <script>
    (function() {
      function run() {
      window.__events = window.__events || [];
      var BAND_MIDPOINTS = { 'under_2000': 1500, '2000_3000': 2500, '3000_4000': 3500, '4000_5000': 4500, '5000_plus': 6000 };
      var TARIFF = 0.35;
      var PRODUCTION = 9000;
      var FIT = 0.08;
      var SYSTEM_COST = 8000;

      function isUnlocked() {
        try {
          if (typeof localStorage !== 'undefined' && localStorage.getItem('lite_paid') === 'true') return true;
          if (typeof URLSearchParams !== 'undefined' && window.location.search) {
            var p = new URLSearchParams(window.location.search);
            if (p.get('unlocked') === '1') return true;
          }
          return (typeof localStorage !== 'undefined' && localStorage.getItem('lite_unlocked') === 'true');
        } catch (e) { return false; }
      }

      function selfConsumptionRate(data) {
        var day = data.daytimeAtHome === 'yes';
        var allElec = data.allElectricNoGas === 'yes';
        var big = data.bigLoads || [];
        var rate = 0.40;
        if (day && allElec) rate = 0.65;
        else if (day) rate = 0.55;
        else if (allElec) rate = 0.50;
        if (big.indexOf('ducted_ac') !== -1 || big.indexOf('electric_hot_water') !== -1) rate = Math.min(0.70, rate + 0.05);
        return rate;
      }

      function calcFullResult() {
        var profile = calcProfile();
        if (!profile) return null;
        var sc = selfConsumptionRate(formData);
        var annualKwh = profile.annualKwh;
        var selfUse = Math.min(PRODUCTION * sc, annualKwh);
        var exportKwh = Math.max(0, PRODUCTION - selfUse);
        var annualSavings = selfUse * TARIFF + exportKwh * FIT;
        var savingsLow = Math.round(annualSavings * 0.9);
        var savingsHigh = Math.round(annualSavings * 1.1);
        var paybackHigh = SYSTEM_COST / savingsLow;
        var paybackLow = SYSTEM_COST / savingsHigh;
        var paybackMid = (paybackLow + paybackHigh) / 2;
        var roundHalf = function(n) { return Math.round(n * 2) / 2; };
        var outlook = paybackMid <= 7 ? 'Financially reasonable' : paybackMid <= 10 ? 'Needs deeper review' : 'Financially marginal';
        var outlookIcon = paybackMid <= 7 ? '✓' : paybackMid <= 10 ? '!' : '×';
        var daytime = formData.daytimeAtHome === 'yes';
        var allElectric = formData.allElectricNoGas === 'yes';
        var bigLoads = formData.bigLoads || [];
        var evPlan = formData.evPlan === 'yes';
        var dayLabel = daytime ? 'High' : 'Medium';
        var elecLabel = allElectric ? 'All-electric' : 'Mixed';
        var bigLabels = { ducted_ac: 'Ducted air conditioning', electric_hot_water: 'Electric hot water', electric_cooking: 'Electric cooking', pool: 'Pool', heat_pump_hot_water: 'Heat pump hot water' };
        var majorLoadsList = bigLoads.map(function(k) { return bigLabels[k] || k; }).join(', ') || 'None';
        var batteryGuide = evPlan ? 'Consider later' : (!daytime && allElectric) ? 'Worth exploring' : 'Not needed yet';
        var showReadiness = allElectric || evPlan || bigLoads.indexOf('ducted_ac') !== -1 || bigLoads.indexOf('electric_hot_water') !== -1;
        return {
          profile: profile,
          savingsLow: savingsLow,
          savingsHigh: savingsHigh,
          paybackLow: roundHalf(paybackLow),
          paybackHigh: roundHalf(paybackHigh),
          paybackMid: paybackMid,
          outlook: outlook,
          outlookIcon: outlookIcon,
          sc: sc,
          dayLabel: dayLabel,
          elecLabel: elecLabel,
          majorLoadsList: majorLoadsList,
          evPlan: evPlan,
          batteryGuide: batteryGuide,
          showReadiness: showReadiness,
          daytime: daytime,
          allElectric: allElectric,
          bigLoads: bigLoads
        };
      }

      function formatCurrency(n) { return '$' + Number(n).toLocaleString('en-AU', { maximumFractionDigits: 0 }); }
      function formatYears(n) { return Number(n).toFixed(1) + ' years'; }

      function renderFullResult() {
        var full = document.getElementById('full-result');
        var locked = document.getElementById('locked-box');
        if (!full || !locked) return;
        var result = calcFullResult();
        if (!result) { full.classList.add('hidden'); locked.classList.remove('hidden'); return; }
        var p = result.profile;
        var email = (formData.email || '').trim() || '—';
        var today = new Date().toLocaleDateString('en-AU', { year: 'numeric', month: 'long', day: 'numeric' });
        var outlookRationale = result.outlook === 'Financially reasonable' ? 'Payback falls within a typical range for solar in SA.' : result.outlook === 'Needs deeper review' ? 'Payback is longer; tariff and usage details may affect the outcome.' : 'Payback may be extended; on-site assessment can clarify.';
        if (result.daytime) outlookRationale += ' Daytime use supports self-consumption.';
        if (result.allElectric) outlookRationale += ' All-electric homes often benefit more.';
        var showCapacityAdvisory = result.allElectric || result.evPlan || result.bigLoads.indexOf('ducted_ac') !== -1;
        var confirmationText = result.outlook === 'Financially reasonable' ? 'Based on your answers, solar appears financially reasonable for your home.' : result.outlook === 'Needs deeper review' ? 'Based on your answers, solar is conditional – further review recommended for your home.' : 'Based on your answers, solar does not appear financially ideal for your home.';

        var html = '';
        var paidUnlock = typeof localStorage !== 'undefined' && localStorage.getItem('lite_paid') === 'true';
        html += '<p class="result-confirmation">' + escapeHtml(confirmationText) + '</p>';
        html += '<div class="report-card report-header">';
        html += '<h2>Energy Decision Summary (Lite)</h2>';
        if (paidUnlock) html += '<p class="payment-confirmed" style="margin:0.5rem 0 0;font-size:0.9375rem;color:var(--muted);">Unlocked. Credit will apply if you proceed with Pro.</p>';
        html += '<p class="subline">Generated for: ' + escapeHtml(email) + ' · Adelaide, SA · ' + today + '</p>';
        html += '<p class="badges">Independent advice · No installation · No commissions</p>';
        html += '</div>';

        html += '<div class="report-card hero-summary">';
        html += '<p class="label">Estimated annual savings</p>';
        html += '<p class="big-number">' + formatCurrency(result.savingsLow) + ' – ' + formatCurrency(result.savingsHigh) + ' / year</p>';
        html += '<p class="label">Estimated payback</p>';
        html += '<p class="big-number">' + formatYears(result.paybackLow) + ' – ' + formatYears(result.paybackHigh) + '</p>';
        html += '<p class="footnote">Based on a standard 6.6kW system and typical SA assumptions.</p>';
        html += '<h3 style="margin-top:1.25rem;font-size:1rem;">What this estimate does NOT include</h3>';
        html += '<ul style="margin:0.5rem 0 0;padding-left:1.25rem;font-size:0.9375rem;"><li>Switchboard capacity assessment</li><li>Phase load balancing</li><li>Detailed tariff modelling</li><li>EV charging load impact</li><li>Future electrification expansion</li></ul>';
        html += '<p class="footnote" style="margin-top:0.75rem;">For some homes, these factors materially change the financial outcome.</p>';
        html += '</div>';

        html += '<div class="report-card decision-outlook">';
        html += '<span class="icon" aria-hidden="true">' + result.outlookIcon + '</span>';
        html += '<div><p class="label">Decision outlook: ' + result.outlook + '</p><p>' + outlookRationale + '</p></div>';
        html += '</div>';

        html += '<div class="pro-upgrade-box">';
        html += '<h3>Before committing $15k–$30k</h3>';
        html += '<p>Before you sign anything. Confirm this with a 15-minute independent review.</p>';
        html += '<a href="https://advisory.bhtechnology.com.au/#request-review" class="pro-btn" target="_blank" rel="noopener noreferrer">Book Advisory Call</a>';
        html += '</div>';

        html += '<div class="report-card"><h3>What drove this result</h3><ul>';
        html += '<li>Daytime usage pattern: ' + result.dayLabel + '</li>';
        html += '<li>Home electrification: ' + result.elecLabel + '</li>';
        html += '<li>Major loads: ' + escapeHtml(result.majorLoadsList) + '</li>';
        html += '<li>EV plan: ' + (result.evPlan ? 'Yes' : 'No') + '</li>';
        html += '</ul></div>';

        html += '<div class="report-card accordion-item"><button type="button" class="accordion-head" aria-expanded="false">Assumptions used</button><div class="accordion-body">';
        html += '<ul><li>Solar size: 6.6kW</li><li>Annual generation: ~9,000 kWh/year</li><li>Tariff: $0.35/kWh (default estimate)</li><li>Feed-in tariff: $0.08/kWh (default)</li><li>System cost: $8,000 (placeholder)</li><li>Self-consumption rate: ' + Math.round(result.sc * 100) + '%</li></ul>';
        html += '<p class="footnote">Savings and payback are a range because usage and tariffs vary. Pro uses on-site data for higher accuracy.</p></div></div>';

        html += '<div class="report-card"><h3>Battery guidance</h3>';
        html += '<p>' + result.batteryGuide + '.</p>';
        html += '<p class="footnote">For battery decisions, Pro is recommended.</p></div>';

        html += '<div class="next-steps-grid">';
        if (showCapacityAdvisory) {
          html += '<div class="advisory-note" style="grid-column:1/-1;">&#9888; System capacity should be reviewed before installation.</div>';
        }
        html += '<div class="next-step-card"><h4>Before committing to solar, confirm the numbers are correct.</h4>';
        html += '<p style="margin:0 0 0.75rem;font-size:0.9375rem;line-height:1.5;">Energy Insight Pro validates whether solar is financially right for your specific home. We measure real load behaviour, review capacity limits, and model tariff impact — so you don\'t rely on installer estimates alone.</p>';
        html += '<ul><li>Confirm if solar truly makes sense</li><li>Validate correct system sizing</li><li>Identify hidden capacity constraints</li><li>Provide written independent recommendation</li></ul>';
        html += '<button type="button" class="btn" id="pro-cta-btn">Confirm this with a 15-minute advisory call</button>';
        html += '<p class="credit-note" style="margin-top:0.5rem;">$199 credited toward Pro</p></div>';
        html += '</div>';

        full.innerHTML = html;
        var proCta = full.querySelector('#pro-cta-btn');
        if (proCta) {
          proCta.addEventListener('click', function() {
            var res = calcFullResult();
            var snapshot = {
              decisionLabel: res ? res.outlook : null,
              savingsLow: res ? res.savingsLow : null,
              savingsHigh: res ? res.savingsHigh : null,
              paybackLow: res ? res.paybackLow : null,
              paybackHigh: res ? res.paybackHigh : null,
              annualBillBand: formData.annualBillBand || null,
              allElectric: res ? res.allElectric : null,
              hasEv: res ? res.evPlan : null,
              hasSolar: false,
              hasBattery: false,
              timestamp: new Date().toISOString()
            };
            var jsonStr = JSON.stringify(snapshot);
            var base64 = btoa(unescape(encodeURIComponent(jsonStr)));
            var base64url = base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
            var nameEl = document.getElementById('name');
            var emailEl = document.getElementById('email');
            var phoneEl = document.getElementById('phone');
            var name = ((nameEl && nameEl.value) || formData.name || '').trim();
            var email = ((emailEl && emailEl.value) || formData.email || '').trim();
            var phone = ((phoneEl && phoneEl.value) || formData.phone || '').trim();
            var billRangeMap = { 'under_2000': 'under $2k', '2000_3000': '$2–3k', '3000_4000': '$3–4k', '4000_5000': '$4k+', '5000_plus': '$4k+' };
            var billRange = billRangeMap[formData.annualBillBand] || '';
            var q = ['src=lite', 'lite=' + encodeURIComponent(base64url)];
            if (name) q.push('name=' + encodeURIComponent(name));
            if (email) q.push('email=' + encodeURIComponent(email));
            if (phone) q.push('phone=' + encodeURIComponent(phone));
            if (billRange) q.push('bill_range=' + encodeURIComponent(billRange));
            var finalUrl = 'https://advisory.bhtechnology.com.au/?' + q.join('&') + '#request-review';
            track('pro_cta_click', { source: 'lite_upgrade', hasEmail: !!email, decisionLabel: res ? res.outlook : null, timestamp: new Date().toISOString() });
            window.open(finalUrl, '_blank', 'noopener,noreferrer');
          });
        }
        full.querySelectorAll('.accordion-head').forEach(function(btn) {
          btn.addEventListener('click', function() {
            var item = btn.closest('.accordion-item');
            item.classList.toggle('open');
            btn.setAttribute('aria-expanded', item.classList.contains('open'));
          });
        });
        full.classList.remove('hidden');
        locked.classList.add('hidden');
      }
      function escapeHtml(s) {
        if (!s) return '';
        var div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
      }

      function track(eventName, params) {
        var payload = { event: eventName, params: params || {}, ts: new Date().toISOString() };
        console.log('[track]', payload);
        window.__events.push(payload);
      }

      function trackEvent(name, params) {
        if (typeof gtag === 'function') {
          gtag('event', name, params || {});
        }
      }

      track('page_open', {});
      window.addEventListener('load', function() { trackEvent('page_open'); });

      var currentStep = 1;
      var totalSteps = 6;
      var formData = {};

      var progressFill = document.getElementById('progress-fill');
      var progressText = document.getElementById('progress-text');
      var form = document.getElementById('snapshot-form');
      var resultsSection = document.getElementById('results-section');
      var unlockBtn = document.getElementById('unlock-btn');
      var unlockModal = document.getElementById('unlock-modal');
      var modalClose = document.getElementById('modal-close');
      var unlockModalSubmit = document.getElementById('unlock-modal-submit');
      var emailInput = document.getElementById('email');
      var emailError = document.getElementById('email-error');
      if (!form || !progressFill || !progressText) return;

      function updateProgress() {
        var pct = (currentStep / totalSteps) * 100;
        progressFill.style.width = pct + '%';
        progressFill.setAttribute('aria-valuenow', Math.round(pct));
        progressText.textContent = 'Step ' + currentStep + ' of ' + totalSteps;
      }

      function showPanel(step) {
        document.querySelectorAll('.form-panel').forEach(function(p) {
          p.classList.toggle('active', parseInt(p.getAttribute('data-step'), 10) === step);
        });
        currentStep = step;
        updateProgress();
        track('question_view', { step: step });
      }

      function selectOption(panelId, name, value) {
        var panel = document.getElementById(panelId);
        if (!panel) return;
        var input = panel.querySelector('input[name="' + name + '"]');
        if (input) {
          input.value = value;
          formData[name] = value;
        }
        panel.querySelectorAll('.option-btn[data-value]').forEach(function(btn) {
          btn.classList.toggle('selected', btn.getAttribute('data-value') === value);
        });
        track('question_answer', { step: currentStep, question: name, value: value });
      }

      function getBigLoads() {
        var checkboxes = form.querySelectorAll('input[name="bigLoads"]:checked');
        return Array.prototype.map.call(checkboxes, function(c) { return c.value; });
      }

      window.scrollToCheck = function() {
        track('hero_cta_click', {});
        var section = document.getElementById('section-1');
        if (section) section.scrollIntoView({ behavior: 'smooth' });
      };
      var bridgeCta = document.getElementById('bridge-cta');
      if (bridgeCta) {
        bridgeCta.addEventListener('click', function() {
          track('bridge_cta_click', {});
          trackEvent('bridge_cta_click');
          track('snapshot_start', {});
          var section = document.getElementById('form-section');
          if (section) section.scrollIntoView({ behavior: 'smooth' });
        });
      }
      function showStepError(step, show) {
        var err = document.getElementById('error-' + step);
        if (err) err.classList.toggle('visible', !!show);
      }

      function findOptionBtn(target) {
        var el = target;
        while (el && el !== form) {
          if (el.classList && el.classList.contains('option-btn') && el.getAttribute('data-value')) return el;
          el = el.parentNode;
        }
        return null;
      }
      form.addEventListener('click', function(e) {
        var btn = findOptionBtn(e.target);
        if (!btn) return;
        e.preventDefault();
        e.stopPropagation();
        var panel = btn.parentNode;
        while (panel && (!panel.classList || !panel.classList.contains('form-panel'))) panel = panel.parentNode;
        if (!panel || !panel.id) return;
        var step = panel.getAttribute('data-step');
        var name = step === '1' ? 'annualBillBand' : step === '2' ? 'daytimeAtHome' : step === '3' ? 'allElectricNoGas' : step === '5' ? 'evPlan' : null;
        if (name) selectOption(panel.id, name, btn.getAttribute('data-value'));
      });

      form.addEventListener('change', function(e) {
        if (e.target && e.target.name === 'bigLoads') {
          formData.bigLoads = getBigLoads();
          track('question_answer', { step: 4, question: 'bigLoads', value: formData.bigLoads });
        }
      });

      function goNext(n) {
        if (n <= totalSteps) showPanel(n);
      }
      function goBack(n) {
        if (n >= 1) showPanel(n);
      }
      document.getElementById('next-1').addEventListener('click', function() {
        if (formData.annualBillBand) { showStepError(1, false); goNext(2); } else showStepError(1, true);
      });
      document.getElementById('back-2').addEventListener('click', function() { goBack(1); });
      document.getElementById('next-2').addEventListener('click', function() {
        if (formData.daytimeAtHome) { showStepError(2, false); goNext(3); } else showStepError(2, true);
      });
      document.getElementById('back-3').addEventListener('click', function() { goBack(2); });
      document.getElementById('next-3').addEventListener('click', function() {
        if (formData.allElectricNoGas) { showStepError(3, false); goNext(4); } else showStepError(3, true);
      });
      document.getElementById('back-4').addEventListener('click', function() { goBack(3); });
      document.getElementById('next-4').addEventListener('click', function() { goNext(5); });
      document.getElementById('back-5').addEventListener('click', function() { goBack(4); });
      document.getElementById('next-5').addEventListener('click', function() {
        if (formData.evPlan) { showStepError(5, false); goNext(6); } else showStepError(5, true);
      });
      document.getElementById('back-6').addEventListener('click', function() { goBack(5); });

      form.addEventListener('keydown', function(e) {
        if (e.key !== 'Enter') return;
        var active = document.querySelector('.form-panel.active');
        if (!active) return;
        var step = parseInt(active.getAttribute('data-step'), 10);
        if (step >= 1 && step <= 5) {
          e.preventDefault();
          var nextBtn = document.getElementById('next-' + step);
          if (nextBtn) nextBtn.click();
        }
      });

      function validateEmail() {
        var v = (emailInput.value || '').trim();
        var re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        var ok = re.test(v);
        emailInput.classList.toggle('error', !ok);
        emailError.classList.toggle('visible', !ok);
        return ok;
      }
      emailInput.addEventListener('blur', validateEmail);
      emailInput.addEventListener('input', function() {
        emailInput.classList.remove('error');
        emailError.classList.remove('visible');
      });

      function calcProfile() {
        var band = formData.annualBillBand;
        var mid = BAND_MIDPOINTS[band];
        if (mid == null) return null;
        var annualKwh = mid / TARIFF;
        var low = Math.round(annualKwh * 0.9);
        var high = Math.round(annualKwh * 1.1);
        var daytime = formData.daytimeAtHome === 'yes';
        var allElectric = formData.allElectricNoGas === 'yes';
        var bigLoads = formData.bigLoads || [];
        var evPlan = formData.evPlan === 'yes';
        var selfConsumptionNote = 'You use more power during the day.';
        if (!daytime) selfConsumptionNote = "You're often out during the day, so a smaller share of solar may be self-consumed.";
        if (allElectric) selfConsumptionNote += ' All-electric homes tend to benefit more from solar.';
        if (bigLoads.length) selfConsumptionNote += ' Major loads (e.g. pool, AC) affect when you use power and how much you can self-consume.';
        if (evPlan) selfConsumptionNote += ' An EV can increase usage and the value of solar if charged in the right windows.';
        return {
          annualKwh: annualKwh,
          low: low,
          high: high,
          assumptions: [
            'Bill band midpoint: $' + mid + ' → ' + Math.round(annualKwh) + ' kWh/year at $' + TARIFF + '/kWh.',
            'Usage band: ±10% → ' + low + '–' + high + ' kWh/year.',
            'Daytime at home: ' + (daytime ? 'Yes' : 'No') + '.',
            'All-electric: ' + (allElectric ? 'Yes' : 'No') + '.',
            'Big loads: ' + (bigLoads.length ? bigLoads.join(', ') : 'None selected') + '.',
            'EV plan: ' + (evPlan ? 'Yes' : 'No') + '.'
          ],
          whatThisMeans: selfConsumptionNote
        };
      }

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        formData.email = (emailInput.value || '').trim();
        formData.name = (document.getElementById('name').value || '').trim();
        formData.phone = (document.getElementById('phone').value || '').trim();
        if (!validateEmail()) return;
        track('snapshot_complete', { email: formData.email });
        trackEvent('snapshot_complete');
        var profile = calcProfile();
        if (!profile) return;
        document.getElementById('usage-band').textContent = 'Estimated usage: ' + profile.low + '–' + profile.high + ' kWh per year';
        document.getElementById('what-this-means').textContent = profile.whatThisMeans + ' This level of usage can significantly affect the financial outcome.';
        document.getElementById('assumptions-body').innerHTML = '<ul><li>Tariff: $0.35/kWh (estimate).</li><li>System: 6.6kW, ~9,000 kWh/year production.</li></ul>';
        resultsSection.classList.add('visible');
        document.getElementById('free-profile').scrollIntoView({ behavior: 'smooth', block: 'start' });
        // Always show locked state first; full result only after unlock (modal) in this session
        var fullEl = document.getElementById('full-result');
        var lockedEl = document.getElementById('locked-box');
        if (fullEl) fullEl.classList.add('hidden');
        if (lockedEl) lockedEl.classList.remove('hidden');
      });

      function getLiteApiBase() {
        return window.location.origin;
      }
      function buildLiteSnapshot() {
        var res = calcFullResult();
        return {
          decisionLabel: res ? res.outlook : null,
          savingsLow: res ? res.savingsLow : null,
          savingsHigh: res ? res.savingsHigh : null,
          paybackLow: res ? res.paybackLow : null,
          paybackHigh: res ? res.paybackHigh : null,
          annualBillBand: formData.annualBillBand || null,
          allElectric: res ? res.allElectric : null,
          hasEv: res ? res.evPlan : null,
          formData: formData,
          timestamp: new Date().toISOString()
        };
      }
      if (unlockBtn) {
        unlockBtn.addEventListener('click', function() {
          var email = (formData.email || (emailInput ? emailInput.value : '')).trim();
          if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            if (emailError) { emailError.classList.add('visible'); emailError.textContent = 'Please enter your email to unlock (same as in the form above).'; }
            if (emailInput) { emailInput.focus(); }
            track('lite_unlock_click', { source: 'lite_paid', email_present: false });
            trackEvent('lite_unlock_click');
            return;
          }
          track('lite_unlock_click', { source: 'lite_paid', email_present: true, decisionLabel: calcFullResult() ? calcFullResult().outlook : null });
          trackEvent('lite_unlock_click');
          var payload = { name: (formData.name || '').trim(), email: email, phone: (formData.phone || '').trim(), liteSnapshot: buildLiteSnapshot() };
          unlockBtn.disabled = true;
          unlockBtn.textContent = 'Redirecting…';
          fetch(getLiteApiBase() + '/.netlify/functions/createLiteCheckoutSession', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          }).then(function(r) { return r.json().then(function(data) { return { ok: r.ok, data: data }; }); })
            .then(function(result) {
              if (result.ok && result.data.url) {
                try { sessionStorage.setItem('lite_formData', JSON.stringify(formData)); } catch (e) {}
                track('lite_checkout_redirect', { source: 'lite_paid' });
                trackEvent('lite_checkout_redirect');
                window.location.href = result.data.url;
              } else {
                unlockBtn.disabled = false;
                unlockBtn.textContent = 'See the real numbers — $199';
                alert(result.data && result.data.error ? result.data.error : 'Could not start checkout. Please try again.');
              }
            })
            .catch(function() {
              unlockBtn.disabled = false;
              unlockBtn.textContent = 'See the real numbers — $199';
              alert('Network error. Please try again.');
            });
        });
      }

      var debugReset = document.getElementById('debug-reset');
      var resetUnlockLink = document.getElementById('reset-unlock-link');
      if (debugReset && resetUnlockLink) {
        if (typeof URLSearchParams !== 'undefined' && new URLSearchParams(window.location.search).get('debug') === '1') {
          debugReset.classList.remove('hidden');
        }
        resetUnlockLink.addEventListener('click', function(e) {
          e.preventDefault();
          try {
            localStorage.removeItem('lite_unlocked');
            localStorage.removeItem('lite_paid');
            localStorage.removeItem('lite_paid_at');
            sessionStorage.removeItem('lite_formData');
          } catch (err) {}
          window.location.reload();
        });
      }

      function closeModal() {
        if (unlockModal) { unlockModal.classList.remove('visible'); unlockModal.setAttribute('aria-hidden', 'true'); }
        renderFullResult();
      }
      if (modalClose) modalClose.addEventListener('click', closeModal);
      if (unlockModal) unlockModal.addEventListener('click', function(e) {
        if (e.target === unlockModal) closeModal();
      });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && unlockModal && unlockModal.classList.contains('visible')) closeModal();
      });

      if (unlockModalSubmit) unlockModalSubmit.addEventListener('click', function() {
        var emailMe = document.getElementById('email-when-ready').checked;
        track('unlock_modal_submit', { emailWhenReady: emailMe });
        closeModal();
      });

      document.querySelectorAll('.accordion-head').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var item = btn.closest('.accordion-item');
          item.classList.toggle('open');
          btn.setAttribute('aria-expanded', item.classList.contains('open'));
        });
      });
      document.querySelectorAll('.faq-q').forEach(function(btn) {
        btn.addEventListener('click', function() {
          var item = btn.closest('.faq-item');
          var isOpen = item.classList.toggle('open');
          document.querySelectorAll('.faq-item').forEach(function(other) {
            if (other !== item) other.classList.remove('open');
          });
          if (!isOpen) item.classList.remove('open');
        });
      });

      updateProgress();

      (function handleCheckoutReturn() {
        var p = typeof URLSearchParams !== 'undefined' ? new URLSearchParams(window.location.search) : null;
        if (!p || p.get('checkout') !== 'success') return;
        var sessionId = p.get('session_id');
        if (!sessionId) return;
        fetch(window.location.origin + '/.netlify/functions/verifyLitePayment?session_id=' + encodeURIComponent(sessionId))
          .then(function(r) { return r.json(); })
          .then(function(data) {
            if (!data || data.paid !== true) return;
            try {
              localStorage.setItem('lite_paid', 'true');
              localStorage.setItem('lite_paid_at', new Date().toISOString());
              var stored = sessionStorage.getItem('lite_formData');
              if (stored) { try { var o = JSON.parse(stored); if (o && typeof o === 'object') formData = o; } catch (e) {} }
            } catch (e) {}
            track('lite_payment_verified', { source: 'lite_paid', creditAmount: data.creditAmount });
            trackEvent('lite_payment_verified', { value: 199, currency: 'AUD' });
            if (window.history && window.history.replaceState) window.history.replaceState({}, '', window.location.pathname || '/');
            if (resultsSection) resultsSection.classList.add('visible');
            renderFullResult();
            var el = document.getElementById('free-profile');
            if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          })
          .catch(function() {});
      })();
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', run);
      } else {
        run();
      }
    })();
  </script>
</body>
</html>
